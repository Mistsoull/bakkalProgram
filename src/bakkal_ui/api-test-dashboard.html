<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test - Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; background-color: #f9f9f9; }
        .error { color: red; }
        .success { color: green; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Dashboard API Test</h1>
    
    <div class="result">
        <h3>Bugünkü Sipariş Sayısı</h3>
        <div id="orderCountResult">Yükleniyor...</div>
    </div>
    
    <div class="result">
        <h3>Bugün Teslim Edilecek Siparişler</h3>
        <div id="ordersResult">Yükleniyor...</div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5278/api';

        function getTodayDate() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }

        async function testOrderCount() {
            try {
                const today = getTodayDate();
                const response = await fetch(`${API_BASE_URL}/Orders/GetTotalOrderCountByDay?date=${today}`);
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('orderCountResult').innerHTML = 
                        `<span class="success">Başarılı! Sipariş sayısı: ${data.totalOrderCount}</span>`;
                } else {
                    document.getElementById('orderCountResult').innerHTML = 
                        `<span class="error">Hata: ${response.status} - ${response.statusText}</span>`;
                }
            } catch (error) {
                document.getElementById('orderCountResult').innerHTML = 
                    `<span class="error">Network Hatası: ${error.message}</span>`;
            }
        }

        async function testTodayOrders() {
            try {
                const today = getTodayDate();
                const response = await fetch(`${API_BASE_URL}/Orders/GetTodaysOrders?date=${today}`);
                
                if (response.ok) {
                    const orders = await response.json();
                    let html = `<span class="success">Başarılı! ${orders.length} sipariş bulundu</span>`;
                    
                    if (orders.length > 0) {
                        html += `
                            <table>
                                <tr>
                                    <th>Müşteri</th>
                                    <th>Ürün</th>
                                    <th>Miktar</th>
                                    <th>Ödendi</th>
                                    <th>Teslim Edildi</th>
                                </tr>
                        `;
                        
                        orders.forEach(order => {
                            html += `
                                <tr>
                                    <td>${order.customerName} ${order.customerSurname}</td>
                                    <td>${order.productName}</td>
                                    <td>${order.quantity}</td>
                                    <td>${order.isPaid ? 'Evet' : 'Hayır'}</td>
                                    <td>${order.isDelivered ? 'Evet' : 'Hayır'}</td>
                                </tr>
                            `;
                        });
                        
                        html += '</table>';
                    }
                    
                    document.getElementById('ordersResult').innerHTML = html;
                } else {
                    document.getElementById('ordersResult').innerHTML = 
                        `<span class="error">Hata: ${response.status} - ${response.statusText}</span>`;
                }
            } catch (error) {
                document.getElementById('ordersResult').innerHTML = 
                    `<span class="error">Network Hatası: ${error.message}</span>`;
            }
        }

        // Test API calls when page loads
        document.addEventListener('DOMContentLoaded', function() {
            testOrderCount();
            testTodayOrders();
        });
    </script>
</body>
</html>
